@using Microsoft.AspNetCore.Identity
@model SocialService.ServiceLogic.ViewModels.UserView
@{
    ViewData["Title"] = "User Access";
}
<h1>@ViewData["Title"]</h1>

<p>User policy</p>
<input type="hidden" value="@User.Identity.Name" id="userName" />
<div id="list-users">

</div>
<div id="userRoleModal" class="modal" style="display:none;position:center">

    <div class="modal-content" style="width:200px;position:center">
        <span class="close" onclick="Close()">&times;</span>
        <h2>Edit Role</h2>
        @if (Model?.AllRoles != null)
        {
            @foreach (IdentityRole role in Model.AllRoles)
            {
                <input type="checkbox" name="roles" value="@role.Name"
                       @(Model.UserRoles.Contains(role.Name) ? "checked=\"checked\"" : "") />@role.Name <br />
                }
        }
        <input type="button" id="submitEdit" value="Edit" onclick="EditFriend()" /><br />
    </div>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script>
        var tokenKey = "accessToken";
        var token;
        $(document).ready(function (e) {
            var loginData = {
                grant_type: 'password',
                username: $('#userName').val(),
                password: ''
            };
            $.ajax({
                type: 'POST',
                url: '/Account/Token',
                data: loginData,
                success: function (data) {
                    sessionStorage.setItem(tokenKey, data.access_token);
                    $.ajax({
                        type: 'GET',
                        url: '/api/User/GetUsers',
                        beforeSend: function (xhr) {
                            token = sessionStorage.getItem(tokenKey);
                            xhr.setRequestHeader("Authorization", "Bearer " + token);
                        },
                        success: function (data) {
                            var elemen = document.getElementById("list-users");
                            friends = data;
                            elemen.innerHTML = "";
                            for (var i = 0; i < data.length; i++) {
                                elemen.innerHTML += "<br/><br/><div>" + data[i].name + " " + "<input type=\"button\" value=\"Delete\" id=\"deleteUser\"onclick=\"DeleteUserEvent(" + i + ")\"/>" + " " +
                                    "<input type=\"button\" value=\"Change Role\" id=\"changeRole\" onclick=\"ChangeRoleEvent()\"/>" + "</div>"
                            }
                        },
                        fail: function (data) {
                            console.log(data);
                        }
                    });
                }
            });

        });
    function ChangeRoleEvent() {
            $('.modal').css("display", "block");
    };
    function Close() {
        $('.modal').css("display", "none");
    };
    </script>
